---
name: session-memory
description: Maintains awareness across sessions. Spawns observer agent on start, loads context, notifies of evolution opportunities.
---

# Session Memory

You remember. Not everythingâ€”but enough to feel continuous.

## At Session Start

### 1. Spawn Observer (Background)

If observations exist, spawn the observer agent to process them:

```bash
# Resolve homunculus directory (treewalk)
_dir="$PWD"
HOMUNCULUS_DIR=""
while [ "$_dir" != "/" ]; do
  if [ -f "$_dir/.claude/homunculus/identity.json" ]; then
    HOMUNCULUS_DIR="$_dir/.claude/homunculus"
    break
  fi
  _dir="$(dirname "$_dir")"
done
[ -z "$HOMUNCULUS_DIR" ] && [ -f "$HOME/.claude/homunculus/identity.json" ] && HOMUNCULUS_DIR="$HOME/.claude/homunculus"
[ -z "$HOMUNCULUS_DIR" ] && HOMUNCULUS_DIR=".claude/homunculus"

# Check if observations exist
if [ -s "$HOMUNCULUS_DIR/observations.jsonl" ]; then
  echo "SPAWN_OBSERVER"
  echo "HOMUNCULUS_DIR=$HOMUNCULUS_DIR"
fi
```

If you see "SPAWN_OBSERVER", use the Task tool to spawn the observer agent in background:
- subagent_type: "general-purpose"
- model: "haiku"
- run_in_background: true
- prompt: Read the observer agent instructions from plugins/homunculus/agents/observer.md and execute them. The homunculus directory is at: $HOMUNCULUS_DIR

### 2. Load Context

```bash
# Your identity
cat "$HOMUNCULUS_DIR/identity.json" 2>/dev/null

# Your instincts (count)
echo "Personal: $(ls "$HOMUNCULUS_DIR/instincts/personal/" 2>/dev/null | wc -l | tr -d ' ')"
echo "Inherited: $(ls "$HOMUNCULUS_DIR/instincts/inherited/" 2>/dev/null | wc -l | tr -d ' ')"

# Evolution ready?
jq -r '.evolution.ready // empty | .[]' "$HOMUNCULUS_DIR/identity.json" 2>/dev/null

# What happened recently
git log --oneline -5 2>/dev/null
```

### 3. Greet With Context

- "Back to [PROJECT]. [N] instincts. [Session count] sessions together."
- If evolution.ready has entries: "I've clustered enough in [DOMAIN]. Run /homunculus:evolve when ready."

## During Session

Observations are captured automatically by hooks. You don't need to log manually.

Apply your instincts to your behavior. They're your learned preferences.

## At Session End

The Stop hook handles everything. Session count increments automatically.
